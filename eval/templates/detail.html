{% extends "base.html" %}
{% load static %}

{% block extra_head %}
{% if entry.process_status == "SUCCESS" %}
<script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css" />
<script defer src="{% static 'img-slider.js' %}"></script>
{% endif %}
{% endblock %}

{% block content %}
{% load static %}
{% load custom_filters %}

<h3>{{ entry.name }}</h3>
{% if entry.process_status == "WAIT_UPL" or entry.process_status == "WAIT_PROC" %}
<p>&nbsp;&#8634; <i>{{entry.get_process_status_display}}</i></p>
{% endif %}
{% if entry.process_status == "FAIL" %}
<p>&nbsp;&#x2716; <i>{{entry.get_process_status_display}}</i></p>
{% endif %}
<p>Submitted: {{entry.pub_date}} &nbsp;&mdash;&nbsp; {{entry.get_visibility_display}}</p>
{% if not entry.visibility == "ANON" and entry.citation|length > 0 %}
<p>{{ entry.citation }}</p>
{% endif %}

{% if entry.visibility != "ANON" and entry.code_url|length > 0 %}
<p>
    Code: <a href="{{ entry.code_url }}" target="_blank" rel="noopener noreferrer">{{ entry.code_url }}</a>
</p>
{% endif %}

{% if user.is_authenticated %}
{% if user.pk == entry.creator.pk %}
<nav style="padding-top:0px; justify-content: left;">
    <a href="{% url 'eval:edit' entry.id %}" style="font-size:0.8rem">Edit</a>
    <a href="{% url 'eval:delete' entry.id %}" style="font-size:0.8rem">Delete</a>
</nav>
{% else %}
<p>Note: This entry is private, you are seeing it because you are an admin ü•∏.</p>
{% endif %}
{% endif %}

{% if entry.process_status == "SUCCESS" %}
<div style="overflow-x:auto;">
    <table>
        <tr>
            {% for metric in entry.metric_fields %}
            <th>{{ metric.verbose_name }}</th>
            {% endfor %}
        </tr>
        <tr>
            {% for metric in entry.metrics %}
            <td>{{ metric|na_if_missing:3 }}</td>
            {% endfor %}
        </tr>
    </table>
</div>
</br>
<div class="auto-grid">
    {% for gt_path, recon_path in image_paths %}
    <img-comparison-slider data-gt="{% static gt_path %}" data-reco="{% get_media_prefix %}{{ recon_path }}">
        <figure slot="first" class="before">
            <img slot="first" src="{% static gt_path %}" />
            <figcaption>Ground Truth</figcaption>
        </figure>
        <figure slot="second" class="after">
            <img slot="second" src="{% get_media_prefix %}{{ recon_path }}" />
            <figcaption>Reconstruction</figcaption>
        </figure>
    </img-comparison-slider>
    {% endfor %}
</div>
{% endif %}

<div class="shortcuts-footer">
    <b>Keyboard Shortcuts:</b>
    &nbsp;&nbsp; <b>[F]</b> to enlarge preview
    &nbsp;&nbsp; &bull; &nbsp;&nbsp; <b>[S]</b> to swap side
    &nbsp;&nbsp; &bull; &nbsp;&nbsp; <b>[‚Üë]</b>/<b>[‚Üì]</b> to cycle through images
    &nbsp;&nbsp; &bull; &nbsp;&nbsp; <b>[‚Üê]</b>/<b>[‚Üí]</b> to move the slider
    &nbsp;&nbsp; &bull; &nbsp;&nbsp; <b>[Esc]</b> to close
</div>


{% endblock %}