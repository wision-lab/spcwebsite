:80, 
:{$PORT}

handle_path /static/* {
    root * /app/staticfiles
    file_server
}

handle_path /media/* {
    # Before serving the media file, go forward the request to django 
    # to check for authorization (at endpoint /auth/check), if we receive 
    # a status==200 we proceed, else serve what django responds. 
    forward_auth localhost:8000 {
        uri /auth/check/ 
    }

    root * /storage/media
    file_server
}

reverse_proxy localhost:8000
